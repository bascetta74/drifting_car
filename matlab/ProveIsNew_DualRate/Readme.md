LINKS:
-matlab tutorial on how to generate a standalone ROS node from a Simulink block scheme:
	https://it.mathworks.com/help/robotics/examples/generate-a-standalone-ros-node-from-simulink.html?s_tid=gn_loc_drop

MY CONFIGURATION:
-ros kinetic 
-ubuntu 16.04 LTS
-Matlab R2017a (officially doesn't support ros kinetic)

ROS nodes:
-talker: is a simple node which publishes a geometry_msgs/PoseArray message on the topic "/chatter". This message is a time-stamped message (in the header) and the header also contains the published sample's sequence number. The pose.position.x field of the message is equal to the number of the message which is being sent.
To run this node execute: rosrun net_test talker
To set the node's frequency, you have to modify the constant LOOP_RATE in the .../catkin_ws/src/net_test/src/talker.cpp node's source file

-withisnew_node: node generated by WithIsNew.slx simulink model.
Node which subscribes to the /chatter topic published by the talker node (net_test package), reads the message's header sequence number, timestamp seconds and timestap nanoseconds and then publishes them with a PointStamped message on the point X,Y and Z fields respectively.
The node contains the IsNew signal, which triggers the "enabled subsystem" which contains the publishing block.
Node sample time is equal to the solver step size, which is fixed
Queue size of both the subscriber and the publisher block is 1

-withoutisnew_node: node generated by WithoutIsNew.slx simulink model

-atomicdualrate_node: node generated by the AtomiDualRate.slx simulink model (rosrun atomicdualrate atomicdualrate_node)

LAUNCH FILES
- catkin_ws/src/net_test/launch there is the ros launch file "IsNew.launch" which launches the chatter node, the WithIsNew_node Simulink chatter node and the WithoutIsNew_node Simulink chatter node. This launch file also automatically launches a rosbag called "IsNew_bag" located in ~/.ros/

PERFORMED TESTS (ROSBAG FILES LEGEND. Files can be found in the RESULTS subsirectory):
01: chatter 100 Hz, Simulink node 0.01 s solver step size and queue sizes =1 of both the subscriber and the publisher simulink block
02: chatter 50 Hz, Simulink node 0.01 s solver step size and queue sizes =1 of both the subscriber and the publisher simulink block
03: chatter 25 Hz, Simulink node 0.01 s solver step size and queue sizes =1 of both the subscriber and the publisher simulink block
AtomicDualRate: chatter 100 Hz, Simulink node with auto solver step size, /Chatter_Fast 100 Hz with queue size 1, /Chatter_Slow 20 Hz with queue size 1

ANNOTATIONS:
a) the default ROS simulink subscriber-publisher model collects all the calculations performed in the node inside an "enabled subsystem", triggered by the IsNew signal which comes from the subscribe simulink block. 
See this link for more details about an enabled susbsystem: https://it.mathworks.com/help/simulink/ug/enabled-subsystems.html

b) to let Simulink generate the ROS node code, it must be able to connect through ssh to your local machine (loopbakc ip address), therefore you need to have an active and running ssh server on your pc; to check its status "service ssh status" and eventually "sudo service ssh start". If ssh server (sshd daemon) is not installed on your pc, type "sudo apt-get install openssh-server

c) to see some examples of how to deal with complex ROS message types inside Simulink, see this model (type its name in the Matlab command window):
robotROSMessageUsageExample

d) the queue size of the node can be set in both the subscriber and in the publisher simulink blocks (tab "code generation")

e) to use continuous time simulink block, in Simulink->Simulation -> Model Configuration parameters -> Code Generation -> Interface you have to tick the support for "continuous time"

f) to debug a ros launch file i.e. to verify if it contains xml-syntax errors, you can use the command line tool xmllint: "xmllint your_xml_file" or you can simply set your text editor (like gedit) in Document/File type/Markup/XML

RESULTS:
-(Conclusion by Marco Baur): blocks inserted inside the enabled subsystem are executed only when the ROS node receives a new message, which, through the IsNew signal, enables the conditionally executed subsystem. If no new messages have come, the enabled subsystem does simply nothing (in this case it doesn't publish), as it is also clearly visible by inspecting the rosbag file with the rqt_bag app. The value of the message is not modified.
When no conditionally executed subsystems are present inside the node, the node holds the previously received message if now new messages have come. This ZOH behaviour is determined by the subscriber simulink block, which explicitly acts as a ZOH

-To build a dual rate node, you can simply define an atomic subsystem for each part of the node which has itw own frequency (see the example AtomicDualRate.slx model). The solver step size can be left to auto: simulink will automatically select it according to the sample times of the atomic subsystems. You can use a rate transition block to handle the different time steps inside the simulink model. To define an atomic subsystem in matlab, first create the normal subsystem then right click on it, select "Block Parameters (subsystem)" and "treat as atomic" then set its sample time.










